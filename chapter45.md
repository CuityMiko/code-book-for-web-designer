第四十五章 继续玩（二）
===

上一节我们完成了一个初级任务——头前进，尾不动。今天我们需要完成一个顶级任务，头不动，尾前进。很复杂的哦！

这时候我们要认真研究一下了，我们现在要是让虫子宽度减小肯定是又把脑袋缩回去了。你想到了，改 left 的值，这个想法似乎正确，但是只改他明显不行，还要同时让宽度变化……想想就晕了。所以我们要换一个思路。

头前进，尾不动其实就是于左侧的距离不变，然后增大宽度；头不动，尾前进也就是与右侧的距离不变，然后缩小宽度。

所以我们首先把他的定位从 left 换做 right，方法如下：

	$("#cz").css("left","auto");
	$("#cz").css("right","50px");

但是当我们将这段代码放进去之后发现情况是：打开页面，虫子蹭的一下跑到右边（因为我现在 right 值设置的比较小），然后开始慢慢变长。咦？这个顺序不对啊！

我们要的是先变长，然后跳到右边（后面我们在研究他位置不变）。但实际执行起来，变长是一个过程（需要一定的时间），但是跳过去（改变一个属性）是瞬间的。而程序挨个通知他们执行，而不是等一个完成才通知下一个，导致了虽然变长最先开始，但是绝大部分的变长动作是在跳到右边之后完成的。明白了吗？打个比方：我要你蹲在瞬间传送仪上，然后我们设想的流程是这样的，我叫你的名字，你缓缓站起来，然后我打开传送，把你传送到宇宙飞船上。但是我叫了你的名字之后立刻打开传送，因为瞬间你就被传出去了，所以虽然你先开始往起站，但实际上你这个站起来的动作大部分还是在传送完成之后完成的。

这显然不是我们期望的，所以我们换个思路：我一喊你的名字“张二狗”，让后你就缓缓的站起来，站好之后你自己开动传送开关，诶，这就附合我们的预期了。那么到程序里呢？

前边我们讲了 animate 有两个参数，一个是变化的内容，一个是变化的速度，然后今天我们说说他的第三个参数——回调函数。什么是回调函数？就是当这个动作执行完之后（比如你站起来之后）要去执行的动作（再去开传送器）。

现在我们来整理我们的代码哦，先写一个带回调函数 animate 哦。

	$("#cz").animate({width:'20px'},1000,function(){
		一会这里写代码
	});

看看比上一节就多了一个逗号，一个 function，我们说了 function 就是塑料袋，一堆代码打包就走。现在我们给 animate 加了个塑料袋，告诉他干完活把这袋盒饭拎走。你看，看着很复杂的句子，仔细一分析其实也没什么。

来，我们给塑料袋里装盒饭，装上之后就变成了

	$("#cz").animate({width:'20px'},1000,function(){
		$("#cz").css("left","auto");
		$("#cz").css("right","50px");
	});

于是虫子开始按我们的想法先变长，然后跳到右边。但是，我们其实并不是要他跳过去的，二是要他保持原地不动，刚才之所以跳一下，是为了判断代码是否正确执行。现在我们来研究他不动的问题。

其实这是一道数学问题：虫子长 20px，虫子尾巴距离左侧 10px，那么虫子距离右侧多远？这个结果就是我们一会要设置的 right 的值。不过我们还缺一个条件：窗口的宽度。

不过这个也简单，获取窗口元素（你也当个元素看就是了）的宽度和获取其他元素宽度是一样，只是注意一下选择器的写法而已。

	windowswidth=$(window).width();

等号后面的才是获取宽度的句子，但是光获取还不行，我们要把它储存起来，留着用，所以我就顺手把它储存在变量 windowswidth 里面了。

然后获取虫子距离左边的距离，这时你高呼着：用 css ，你前两张讲过的，css 方法可以设置，也可以获取。嗯，你说的没错，可是你用 $("#cz").css("left"); 获取到的结果是什么？是 10px ，注意啊，是带着单位的啊，我们要计算是要把安慰去掉的，当然，这个我们也能做得到，不过我懒，就不费那个事了，换个办法更好用的说。

	x=$("#cz").offset();

这个 x 获取到的是两个值，就是元素的左上角那个点的坐标，咦，一个代表两个……怎么用？

x.left 就是元素距离左侧的距离，x.top 就是距离顶部的距离，都是指距离窗口内容区域的边界啊！

然后我们就可以写了

	$("#cz").animate({width:'30px'},600,function(){
		windowswidth=$(window).width();
		x=$("#cz").offset();
		right=windowswidth-$("#cz").width()-x.left;
		$("#cz").css("left","auto");
		$("#cz").css("right",right+"px");
	});

看看能明白不？但是这时候我们遇到一个问题，很有意思啊。你看啊，我们现在可以确定他的头不动了，然后该让尾前进了，其实就是宽度变短，我们知道这个要等上面那些代码都执行完了再执行，那应该把这个变短的动画写在上面的回调函数里。可是变短之后我们还要变长啊，肯定又要写倒变短这个动画的回调函数里，稍稍一想就觉得这是一个不断往里套的过程……，你拿着照片，照片里有你拿着照片……这肯定没法搞啊，所以我们下节课继续。